openapi: 3.0.3
info:
  title: YourCar API
  description: |
    API proxy for Motor.com M1 Vehicle Information System.
    
    This API provides authenticated access to Motor.com M1 endpoints through a Firebase Cloud Function proxy.
    Authentication is handled automatically server-side using Playwright with a library card.
    All requests are routed through `/api/motor-proxy/*` and forwarded to `https://sites.motor.com/m1/*`.
    
    **Base URL:** `https://motorproxy-erohrfg7qa-uc.a.run.app`
    
    **Authentication:** Automatic (server-side session management)
  version: 1.0.0
  contact:
    name: YourCar API Support
    url: https://studio-534897447-7a1e7.web.app

servers:
  - url: https://motorproxy-erohrfg7qa-uc.a.run.app
    description: Production server
  - url: http://localhost:5001
    description: Local development server

tags:
  - name: Health
    description: Health check endpoints
  - name: Vehicle
    description: Vehicle selection and information endpoints
  - name: Search
    description: Article search and filtering endpoints
  - name: Assets
    description: Article content, graphics, and asset endpoints
  - name: Parts
    description: Vehicle parts information endpoints
  - name: Maintenance
    description: Maintenance schedule endpoints
  - name: Labor
    description: Labor operation endpoints
  - name: Track Change
    description: Track change and delta report endpoints
  - name: Bookmarks
    description: Article bookmark endpoints

paths:
  /health:
    get:
      tags:
        - Health
      summary: Health check
      description: |
        Check the health status of the API proxy and authentication session.
        Returns whether the server is authenticated and session expiration information.
      operationId: getHealth
      responses:
        '200':
          description: Health status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
              example:
                status: ok
                authenticated: true
                sessionId: "550e8400-e29b-41d4-a716-446655440000"
                expiresAt: "2024-12-31T23:59:59.000Z"
                timestamp: "2024-01-15T10:30:00.000Z"

  /api/years:
    get:
      tags:
        - Vehicle
      summary: Get available years
      description: Retrieve a list of all available vehicle model years.
      operationId: getYears
      responses:
        '200':
          description: List of years
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Int32ListResponse'
              example:
                data: [2024, 2023, 2022, 2021, 2020]

  /api/year/{year}/makes:
    get:
      tags:
        - Vehicle
      summary: Get makes for a year
      description: Retrieve all vehicle makes available for a specific year.
      operationId: getMakes
      parameters:
        - name: year
          in: path
          required: true
          description: Vehicle model year
          schema:
            type: integer
            format: int32
            example: 2024
      responses:
        '200':
          description: List of makes
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MakeListResponse'
              example:
                data: ["Toyota", "Honda", "Ford", "Chevrolet"]

  /api/year/{year}/make/{make}/models:
    get:
      tags:
        - Vehicle
      summary: Get models for a make and year
      description: Retrieve all vehicle models for a specific make and year.
      operationId: getModels
      parameters:
        - name: year
          in: path
          required: true
          description: Vehicle model year
          schema:
            type: integer
            format: int32
            example: 2024
        - name: make
          in: path
          required: true
          description: Vehicle make
          schema:
            type: string
            example: Toyota
      responses:
        '200':
          description: List of models
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ModelsResponse'

  /api/source/{contentSource}/vehicles:
    post:
      tags:
        - Vehicle
      summary: Get vehicle details
      description: Retrieve detailed information for multiple vehicles by their IDs.
      operationId: getVehicles
      parameters:
        - name: contentSource
          in: path
          required: true
          description: Content source identifier
          schema:
            $ref: '#/components/schemas/ContentSource'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GetVehiclesRequest'
            example:
              vehicleIds: ["12345", "67890"]
      responses:
        '200':
          description: Vehicle details
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Vehicle'

  /api/source/{contentSource}/{vehicleId}/motorvehicles:
    get:
      tags:
        - Vehicle
      summary: Get motor vehicle details
      description: Retrieve motor vehicle details including engine and submodel information.
      operationId: getMotorVehicleDetails
      parameters:
        - name: contentSource
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/ContentSource'
        - name: vehicleId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Motor vehicle details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MotorVehicleDetailsResponse'

  /api/source/{contentSource}/{vehicleId}/name:
    get:
      tags:
        - Vehicle
      summary: Get vehicle name
      description: Retrieve the display name for a vehicle.
      operationId: getVehicleName
      parameters:
        - name: contentSource
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/ContentSource'
        - name: vehicleId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Vehicle name
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StringResponse'

  /api/source/{contentSource}/vehicle/{vehicleId}/articles/v2:
    get:
      tags:
        - Search
      summary: Search articles
      description: |
        Search for articles matching a vehicle and optional search term.
        Returns article metadata, filter tabs, and geo-blocking information.
      operationId: getSearchResultsByVehicleId
      parameters:
        - name: contentSource
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/ContentSource'
        - name: vehicleId
          in: path
          required: true
          schema:
            type: string
        - name: searchTerm
          in: query
          required: false
          description: Search term to filter articles
          schema:
            type: string
            example: "brake pad"
        - name: motorVehicleId
          in: query
          required: false
          description: Motor vehicle ID for engine/submodel filtering
          schema:
            type: string
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchResultsResponse'

  /api/source/{contentSource}/vehicle/{vehicleId}/article/{articleId}:
    get:
      tags:
        - Assets
      summary: Get article content
      description: Retrieve the full HTML content of an article.
      operationId: getArticleById
      parameters:
        - name: contentSource
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/ContentSource'
        - name: vehicleId
          in: path
          required: true
          schema:
            type: string
        - name: articleId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Article HTML content
          content:
            text/html:
              schema:
                type: string

  /api/source/{contentSource}/vehicle/{vehicleId}/article/{articleId}/title:
    get:
      tags:
        - Assets
      summary: Get article title
      description: Retrieve the title of an article.
      operationId: getArticleTitle
      parameters:
        - name: contentSource
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/ContentSource'
        - name: vehicleId
          in: path
          required: true
          schema:
            type: string
        - name: articleId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Article title
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StringResponse'

  /api/source/{contentSource}/xml/{articleId}:
    get:
      tags:
        - Assets
      summary: Get article XML
      description: Retrieve the raw XML content of an article.
      operationId: getXmlById
      parameters:
        - name: contentSource
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/ContentSource'
        - name: articleId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Article XML content
          content:
            application/xml:
              schema:
                type: string

  /api/source/{contentSource}/graphic/{id}:
    get:
      tags:
        - Assets
      summary: Get graphic/image
      description: |
        Retrieve a graphic or image asset.
        Returns binary image data (JPEG, PNG, SVG, etc.).
      operationId: getGraphic
      parameters:
        - name: contentSource
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/ContentSource'
        - name: id
          in: path
          required: true
          description: Graphic/image identifier
          schema:
            type: string
      responses:
        '200':
          description: Image binary data
          content:
            image/jpeg:
              schema:
                type: string
                format: binary
            image/png:
              schema:
                type: string
                format: binary
            image/svg+xml:
              schema:
                type: string
                format: binary

  /api/source/{contentSource}/vehicle/{vehicleId}/parts:
    get:
      tags:
        - Parts
      summary: Get parts for vehicle
      description: Retrieve all parts associated with a vehicle.
      operationId: getPartsForVehicle
      parameters:
        - name: contentSource
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/ContentSource'
        - name: vehicleId
          in: path
          required: true
          schema:
            type: string
        - name: motorVehicleId
          in: query
          required: false
          description: Motor vehicle ID for engine/submodel filtering
          schema:
            type: string
      responses:
        '200':
          description: List of parts
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PartLineItem'

  /api/source/{contentSource}/vehicle/{vehicleId}/labor/{articleId}:
    get:
      tags:
        - Labor
      summary: Get labor operation details
      description: Retrieve detailed labor operation information for an article.
      operationId: getLaborDetails
      parameters:
        - name: contentSource
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/ContentSource'
        - name: vehicleId
          in: path
          required: true
          schema:
            type: string
        - name: articleId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Labor operation details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Labor'

  /api/source/{contentSource}/vehicle/{vehicleId}/maintenanceSchedules/frequency:
    get:
      tags:
        - Maintenance
      summary: Get maintenance schedules by frequency
      description: Retrieve maintenance schedules organized by frequency.
      operationId: getMaintenanceSchedulesByFrequency
      parameters:
        - name: contentSource
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/ContentSource'
        - name: vehicleId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Maintenance schedules by frequency
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MaintenanceSchedulesByFrequency'

  /api/source/{contentSource}/vehicle/{vehicleId}/maintenanceSchedules/intervals:
    get:
      tags:
        - Maintenance
      summary: Get maintenance schedules by interval
      description: Retrieve maintenance schedules organized by interval type.
      operationId: getMaintenanceSchedulesByInterval
      parameters:
        - name: contentSource
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/ContentSource'
        - name: vehicleId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Maintenance schedules by interval
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MaintenanceSchedulesByInterval'

  /api/source/{contentSource}/vehicle/{vehicleId}/maintenanceSchedules/indicators:
    get:
      tags:
        - Maintenance
      summary: Get indicators with maintenance schedules
      description: Retrieve maintenance indicators and their associated schedules.
      operationId: getIndicatorsWithMaintenanceSchedules
      parameters:
        - name: contentSource
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/ContentSource'
        - name: vehicleId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Indicators with maintenance schedules
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IndicatorsWithMaintenanceSchedules'

  /api/source/{contentSource}/vehicle/{vehicleId}/article/{articleId}/bookmark:
    post:
      tags:
        - Bookmarks
      summary: Save bookmark
      description: Save a bookmark for an article.
      operationId: saveBookmark
      parameters:
        - name: contentSource
          in: path
          required: true
          schema:
            $ref: '#/components/schemas/ContentSource'
        - name: vehicleId
          in: path
          required: true
          schema:
            type: string
        - name: articleId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Bookmark saved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true

  /api/source/track-change/processingquarters:
    get:
      tags:
        - Track Change
      summary: Get processing quarters
      description: Retrieve available processing quarters for track change reports.
      operationId: getProcessingQuarters
      responses:
        '200':
          description: List of processing quarters
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
              example: ["2024-Q1", "2024-Q2", "2023-Q4"]

  /api/source/track-change/deltareport:
    get:
      tags:
        - Track Change
      summary: Get vehicle delta report
      description: Retrieve a delta report showing changes for a vehicle.
      operationId: getVehicleDeltaReport
      parameters:
        - name: vehicleId
          in: query
          required: true
          schema:
            type: string
        - name: processingQuarter
          in: query
          required: true
          schema:
            type: string
            example: "2024-Q1"
      responses:
        '200':
          description: Vehicle delta report
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VehicleDeltaReport'

components:
  schemas:
    HealthResponse:
      type: object
      properties:
        status:
          type: string
          example: "ok"
        authenticated:
          type: boolean
          description: Whether the server has an active authentication session
        sessionId:
          type: string
          format: uuid
          description: Current session identifier
        expiresAt:
          type: string
          format: date-time
          description: Session expiration timestamp
        timestamp:
          type: string
          format: date-time
          description: Current server timestamp

    ContentSource:
      type: string
      enum:
        - Motor
        - AllData
        - Mitchell
        - Identifix
      description: Content source identifier
      example: Motor

    Int32ListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            type: integer
            format: int32
      example:
        data: [2024, 2023, 2022]

    MakeListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            type: string
      example:
        data: ["Toyota", "Honda", "Ford"]

    ModelsResponse:
      type: object
      properties:
        data:
          type: array
          items:
            type: object
            properties:
              model:
                type: string
              engines:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: string
                    name:
                      type: string

    GetVehiclesRequest:
      type: object
      required:
        - vehicleIds
      properties:
        vehicleIds:
          type: array
          items:
            type: string
          example: ["12345", "67890"]

    Vehicle:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        year:
          type: integer
        make:
          type: string
        model:
          type: string

    MotorVehicleDetailsResponse:
      type: object
      properties:
        data:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
              model:
                type: string
              engines:
                type: array
                items:
                  type: object

    StringResponse:
      type: object
      properties:
        data:
          type: string
      example:
        data: "2024 Toyota Camry"

    SearchResultsResponse:
      type: object
      properties:
        articleDetails:
          type: array
          items:
            $ref: '#/components/schemas/ArticleDetails'
        filterTabs:
          type: array
          items:
            $ref: '#/components/schemas/FilterTab'
        vehicleGeoBlockingDetails:
          $ref: '#/components/schemas/VehicleGeoBlockingDetails'

    ArticleDetails:
      type: object
      properties:
        id:
          type: string
        title:
          type: string
        description:
          type: string
        category:
          type: string

    FilterTab:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        type:
          type: string
        count:
          type: integer

    VehicleGeoBlockingDetails:
      type: object
      properties:
        isBlocked:
          type: boolean
        reason:
          type: string

    PartLineItem:
      type: object
      properties:
        id:
          type: string
        partNumber:
          type: string
        description:
          type: string
        quantity:
          type: integer

    Labor:
      type: object
      properties:
        mainOperation:
          type: object
          properties:
            id:
              type: string
            description:
              type: string
            laborTime:
              type: number
              format: float

    MaintenanceSchedulesByFrequency:
      type: object
      properties:
        data:
          type: array
          items:
            type: object

    MaintenanceSchedulesByInterval:
      type: object
      properties:
        data:
          type: object
          additionalProperties:
            type: array
            items:
              type: object

    IndicatorsWithMaintenanceSchedules:
      type: object
      properties:
        data:
          type: array
          items:
            type: object
            properties:
              indicator:
                type: string
              schedules:
                type: array
                items:
                  type: object

    VehicleDeltaReport:
      type: object
      properties:
        vehicleId:
          type: string
        processingQuarter:
          type: string
        changes:
          type: array
          items:
            type: object

